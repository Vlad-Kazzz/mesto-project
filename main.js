(()=>{"use strict";function t(t){t.target.classList.contains("popup_opened")&&M(document.querySelector(".popup_opened"))}function e(t){27===t.keyCode&&M(document.querySelector(".popup_opened"))}var o=document.querySelector(".photo-grid__list"),n=document.querySelector("#photos-element").content,r=document.querySelector("#input-title"),u=document.querySelector("#input-link"),c=document.querySelector(".popup-photos"),i=document.querySelector(".popup-photos__image"),a=document.querySelector(".popup-photos__title"),l=document.querySelectorAll(".popup__close-button"),s=document.querySelector(".popup-edit"),d=document.querySelector(".profile__edit-button"),p=document.querySelector(".popup__edit-form"),_=document.querySelector(".profile__name"),m=document.querySelector(".profile__about"),f=document.querySelector("#input-name"),v=document.querySelector("#input-about"),y=p.querySelector(".edit-form__submit-button"),S=document.querySelector(".popup-edit-avatar"),h=document.querySelector(".profile__image-container"),b=document.querySelector(".popup__edit-avatar-form"),q=b.querySelector("#input-avatar"),C=b.querySelector(".edit-avatar-form__submit-button"),g=document.querySelector(".profile__image"),L=document.querySelector(".popup__place-form"),E=L.querySelector(".place-form__submit-button"),k=L.querySelector("#input-title"),x=L.querySelector("#input-link"),T=document.querySelector(".popup-new-place"),A=document.querySelector(".profile__add-button"),B=document.querySelector(".popup__confirm-delete"),D=document.querySelector(".popup__confirm-delete-form"),P=D.querySelector(".popup__confirm-delete-button"),w={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button-save",disabledButtonClass:"popup__button-save_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"};function j(o){o.classList.add("popup_opened"),document.addEventListener("keydown",e),document.addEventListener("click",t)}function M(o){o.classList.remove("popup_opened"),document.removeEventListener("keydown",e),document.removeEventListener("click",t)}l.forEach((function(t){return t.addEventListener("click",(function(t){return M(t.target.closest(".popup"))}))}));var U,H=function(t,e,o){!function(t){return t.some((function(t){return!t.validity.valid}))}(t)?(e.classList.remove(o.disabledButtonClass),e.disabled=!1):(e.classList.add(o.disabledButtonClass),e.disabled=!0)},N={baseUrl:"https://nomoreparties.co/v1/".concat("plus-cohort-17"),headers:{authorization:"05444bda-d82e-43a1-ae97-19d1fc6a52cf","Content-type":"application/json"}};function O(t){void 0===t.status?console.error("Неизвестная ошибка"):console.error("Ошибка ".concat(t.status))}function V(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n={method:e,headers:N.headers};return o&&(n.body=JSON.stringify(o)),fetch("".concat(N.baseUrl,"/").concat(t),n).then((function(t){return t.ok?t.json():Promise.reject(t)}))}function z(t){var e=n.querySelector(".photo-grid__element").cloneNode(!0);e.querySelector(".photo-grid__title").textContent=t.name;var o=e.querySelector(".photo-grid__image"),r=e.querySelector(".photo-grid__likes-count-text");r.textContent=t.likes.length;var u=e.querySelector(".photo-grid__like-button");(function(t){return t.likes.some((function(t){return t._id===U}))})(t)&&u.classList.add("photo-grid__like-button_active"),e.querySelector(".photo-grid__like-button").addEventListener("click",(function(o){var n;o.target.classList.contains("photo-grid__like-button_active")?(n=t._id,V("cards/likes/".concat(n),"DELETE")).then((function(t){e.querySelector(".photo-grid__like-button").classList.remove("photo-grid__like-button_active"),r.textContent=t.likes.length})).catch(O):function(t){return V("cards/likes/".concat(t),"PUT")}(t._id).then((function(t){e.querySelector(".photo-grid__like-button").classList.add("photo-grid__like-button_active"),r.textContent=t.likes.length})).catch(O)}));var c=t.owner._id;return U!==c?e.querySelector(".photo-grid__delete-button").classList.add("photo-grid__delete-button_hidden"):e.querySelector(".photo-grid__delete-button").addEventListener("click",(function(e){j(B),B.id=t._id,B.card=e.target.closest(".photo-grid__element"),D.addEventListener("submit",(function t(e){var o;e.preventDefault(),P.textContent="Удаление...",(o=B.id,V("cards/".concat(o),"DELETE")).then((function(){B.card.remove(),M(B),D.removeEventListener("submit",t)})).catch(O).finally((function(){setTimeout((function(){return P.textContent="Да"}),1e3)}))}))})),o.src=t.link,o.alt=t.name,o.addEventListener("click",G),e}function G(t){var e=t.target,o=e.closest(".photo-grid__element").querySelector(".photo-grid__title");i.src=e.src,i.alt=o.textContent,a.textContent=o.textContent,j(c)}function J(t,e){e.prepend(t)}A.addEventListener("click",(function(){L.reset(),H([k,x],E,w),j(T)})),L.addEventListener("submit",(function(t){var e,n;t.preventDefault(),E.textContent="Создание...",(e=r.value,n=u.value,V("cards","POST",{name:e,link:n})).then((function(t){J(z(t),o),M(T)})).catch(O).finally((function(){setTimeout((function(){return E.textContent="Создать"}),1e3)}))})),d.addEventListener("click",(function(){f.value=_.textContent,v.value=m.textContent,H([f,v],y,w),j(s)})),p.addEventListener("submit",(function(t){var e,o;t.preventDefault(),y.textContent="Сохранение...",(e=f.value,o=v.value,V("users/me","PATCH",{name:e,about:o})).then((function(t){_.textContent=t.name,m.textContent=t.about,M(s)})).catch(O).finally((function(){setTimeout((function(){return y.textContent="Сохранить"}),1e3)}))})),h.addEventListener("click",(function(){b.reset(),H([q],C,w),j(S)})),b.addEventListener("submit",(function(t){var e;t.preventDefault(),C.textContent="Сохранение...",(e=q.value,V("users/me/avatar","PATCH",{avatar:e})).then((function(t){g.src=t.avatar,M(S)})).catch(O).finally((function(){setTimeout((function(){return C.textContent="Сохранить"}),1e3)}))})),function(t){Array.from(document.querySelectorAll(t.formSelector)).forEach((function(e){e.addEventListener("submit",(function(t){t.preventDefault()})),function(t,e){var o=Array.from(t.querySelectorAll(e.inputSelector)),n=t.querySelector(e.submitButtonSelector);H(o,n,e),o.forEach((function(r){r.addEventListener("input",(function(){!function(t,e,o){e.validity.valid?function(t,e,o){var n=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(o.inputErrorClass),n.textContent="",n.classList.remove(o.errorClass)}(t,e,o):function(t,e,o,n){var r=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(t,e,e.validationMessage,o),e.validity.patternMismatch?e.setCustomValidity(e.dataset.errorMessage):e.setCustomValidity("")}(t,r,e),H(o,n,e)}))}))}(e,t)}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button-save",disabledButtonClass:"popup__button-save_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__input-error_active"}),Promise.all([V("users/me"),V("cards")]).then((function(t){var e;e=t[0]._id,U=e,_.textContent=t[0].name,m.textContent=t[0].about,g.src=t[0].avatar,t[1].reverse().forEach((function(t){J(z(t),o)}))})).catch(O)})();